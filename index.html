<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>카카오 채널 홈 열기</title>
  <!-- Kakao JavaScript SDK 불러오기 -->
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <script>
    // Kakao SDK 초기화 (실제 발급받은 JavaScript 키로 교체)
    Kakao.init('90ed090fa6d7044e65e276410a0232d7');
    console.log('Kakao SDK initialized');

    // 모바일 감지 함수 (User-Agent와 화면 너비 사용)
    function isMobile() {
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      const mobileRegex = /(android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini)/i;
      const isSmallScreen = window.innerWidth <= 768;
      return mobileRegex.test(userAgent) || isSmallScreen;
    }

    // 카카오톡 채널 홈(채널 추가) 열기 함수
    function openChannelHome() {
      // 이 함수는 카카오톡 채널의 홈(채널 추가 팝업)을 엽니다.
      // channelPublicId는 실제 사용하시는 카카오톡 채널의 Public ID로 변경해야 합니다.
      Kakao.Channel.addChannel({
        channelPublicId: '_Crxosn'
      });
    }

    // 로그인 상태를 확인하고, 이미 로그인되어 있다면 바로 채널 홈을 엽니다.
    // 토큰이 없으면 로그인/간편가입 절차를 실행합니다.
    function checkLoginAndProceed() {
      var token = Kakao.Auth.getAccessToken();
      if (token) {
        console.log("이미 로그인된 상태입니다. Token:", token);
        openChannelHome();
      } else {
        // 로그인/간편가입 절차 (웹 기반 로그인 팝업) 실행
        var options = {
          scope: 'profile_nickname, profile_image, account_email, gender, age_range, birthyear, phone_number',
          success: function(authObj) {
            console.log("로그인/간편가입 성공:", authObj);
            openChannelHome();
          },
          fail: function(err) {
            console.error("로그인/간편가입 실패:", err);
          }
        };

        // 모바일 기기에서는 네이티브 로그인(throughTalk) 시도
        if (isMobile()) {
          console.log('Mobile device detected');
          options.throughTalk = true;
        } else {
          console.log('Non-mobile device detected');
        }
        
        Kakao.Auth.login(options);
      }
    }
  </script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      background: white;
      text-align: center;
      font-family: sans-serif;
    }
    /* 버튼 스타일 */
    #kakaoChannelBtn {
      background-color: #FEE500; /* 카카오 노란색 */
      border: none;
      border-radius: 4px;
      color: #000;
      font-weight: bold;
      font-size: 14px;
      padding: 10px 20px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      margin-top: 0;
    }
    /* 버튼 내 로고 이미지 스타일 */
    #kakaoChannelBtn img {
      height: 24px;
      margin-right: 0;
    }
  </style>
</head>
<body>
  <!-- 카카오 채널 홈 열기 버튼 -->
  <button id="kakaoChannelBtn" onclick="checkLoginAndProceed()">
    <img src="https://github.com/jayhaja/act_now_korea_join/raw/main/unnamed.png" alt="카카오 로고">
    카카오 채널 홈 열기
  </button>
</body>
</html>
